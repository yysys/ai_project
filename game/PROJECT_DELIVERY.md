# 项目交付文档 - 拯救菜狗

## 项目概述

"拯救菜狗"是一款完整的抖音小游戏，采用微信小程序框架开发（兼容抖音小游戏）。游戏实现了产品文档中设计的所有核心功能和页面。

## 技术栈

- **开发框架**: 微信小程序（兼容抖音小游戏）
- **编程语言**: JavaScript
- **测试框架**: Jest
- **渲染引擎**: Canvas 2D
- **数据存储**: 微信小程序本地存储

## 项目结构

```
game/
├── app.js                 # 小程序入口
├── app.json              # 小程序配置
├── app.wxss              # 全局样式
├── sitemap.json          # 站点地图
├── package.json          # 依赖配置
├── jest.config.js        # 测试配置
├── README.md            # 项目说明
├── utils/               # 核心工具模块
│   ├── constants.js      # 常量定义
│   ├── unit.js           # 单位类（Unit, VegetableDog, Wolf）
│   ├── unitManager.js    # 单位管理器
│   ├── levelManager.js   # 关卡管理器
│   ├── gameStateManager.js # 游戏状态管理器
│   └── gameEngine.js     # 游戏引擎
├── pages/               # 页面组件
│   ├── index/            # 主页
│   │   ├── index.js
│   │   ├── index.wxml
│   │   ├── index.wxss
│   │   └── index.json
│   ├── level/            # 关卡选择页
│   │   ├── level.js
│   │   ├── level.wxml
│   │   ├── level.wxss
│   │   └── level.json
│   ├── game/             # 游戏页
│   │   ├── game.js
│   │   ├── game.wxml
│   │   ├── game.wxss
│   │   └── game.json
│   └── result/           # 结果页
│       ├── result.js
│       ├── result.wxml
│       ├── result.wxss
│       └── result.json
└── tests/               # 单元测试
    ├── constants.test.js
    ├── unit.test.js
    ├── unitManager.test.js
    ├── levelManager.test.js
    └── gameStateManager.test.js
```

## 核心功能实现

### 1. 游戏引擎（GameEngine）

**文件位置**: `utils/gameEngine.js`

**功能**:
- 游戏循环管理（60 FPS）
- 单位更新和渲染
- 碰撞检测和边界判断
- 游戏状态管理
- 事件处理（胜利、失败、更新）

**关键方法**:
- `init()`: 初始化游戏引擎
- `startLevel()`: 开始指定关卡
- `update()`: 更新游戏状态
- `render()`: 渲染游戏画面
- `handleClick()`: 处理点击事件

### 2. 单位管理器（UnitManager）

**文件位置**: `utils/unitManager.js`

**功能**:
- 创建和管理菜狗和狼
- 处理点击事件
- 更新单位位置
- 边界检测
- 单位状态管理

**关键方法**:
- `createVegetableDog()`: 创建菜狗
- `createWolves()`: 创建狼群
- `clickUnit()`: 点击单位
- `update()`: 更新所有单位
- `checkBoundaries()`: 检测边界

### 3. 关卡管理器（LevelManager）

**文件位置**: `utils/levelManager.js`

**功能**:
- 关卡生成和配置
- 关卡解锁机制
- 星级评定
- 分数计算
- 进度管理

**关键方法**:
- `getLevel()`: 获取关卡
- `setCurrentLevel()`: 设置当前关卡
- `completeLevel()`: 完成关卡
- `calculateStars()`: 计算星级
- `calculateScore()`: 计算分数

### 4. 游戏状态管理器（GameStateManager）

**文件位置**: `utils/gameStateManager.js`

**功能**:
- 游戏状态转换
- 暂停/继续
- 计时器管理
- 事件通知

**关键方法**:
- `setState()`: 设置状态
- `pause()`: 暂停游戏
- `resume()`: 继续游戏
- `getElapsedTime()`: 获取经过时间

## 页面实现

### 1. 主页（index）

**功能**:
- 显示游戏标题和菜狗吉祥物
- 开始游戏按钮
- 设置按钮（预留）

**特色**:
- 浮动动画效果
- 渐变背景
- 响应式设计

### 2. 关卡选择页（level）

**功能**:
- 显示所有关卡
- 关卡解锁状态
- 星级显示
- 总星级统计

**特色**:
- 网格布局
- 锁定/解锁状态
- 点击交互

### 3. 游戏页（game）

**功能**:
- Canvas游戏渲染
- 点击交互
- 暂停/继续
- 重置功能
- 时间显示（限时关卡）

**特色**:
- 45度旋转棋盘
- 实时渲染
- 触摸事件处理
- 暂停遮罩层

### 4. 结果页（result）

**功能**:
- 显示游戏结果
- 星级评定
- 分数显示
- 奖励显示
- 返回首页/下一关

**特色**:
- 胜利/失败不同样式
- 脉冲动画
- 奖励计算

## 测试覆盖

### 测试统计

- **总测试数**: 96
- **通过数**: 96
- **失败数**: 0
- **通过率**: 100%

### 测试模块

1. **constants.test.js** (11个测试)
   - 方向常量
   - 方向向量
   - 方向角度
   - 工具函数

2. **unit.test.js** (17个测试)
   - Unit类构造和方法
   - VegetableDog类
   - Wolf类

3. **unitManager.test.js** (23个测试)
   - 单位创建
   - 点击处理
   - 更新和边界检测
   - 状态查询

4. **levelManager.test.js** (20个测试)
   - 关卡初始化
   - 关卡解锁
   - 星级和分数计算
   - 进度管理

5. **gameStateManager.test.js** (25个测试)
   - 状态管理
   - 暂停/继续
   - 计时器
   - 事件监听

## 游戏机制实现

### 核心玩法

1. **单位系统**
   - 菜狗：位于屏幕中心，金色边框，带光晕效果
   - 狼：随机分布在周围，灰色外观
   - 每个单位有预设的四个对角线方向之一

2. **跑动机制**
   - 点击单位后沿预设方向跑动
   - 四个方向：左上、左下、右上、右下
   - 固定速度：菜狗100px/s，狼120px/s
   - 跑出屏幕边界即消失

3. **胜利条件**
   - 菜狗跑出屏幕边界

4. **失败条件**
   - 限时关卡中超时

### 关卡设计

- **第1-4关**: 普通关卡，狼数量递增（2-5只）
- **第5关**: 限时关卡，3只狼，30秒
- **第6-8关**: 普通关卡，狼数量递增（4-6只）
- **第9关**: 限时关卡，4只狼，25秒
- **第10关**: 普通关卡，6只狼

### 星级评定

- **3星**: 限时关卡中用时<50%
- **2星**: 限时关卡中用时<75%或普通关卡
- **1星**: 限时关卡中用时>75%

### 分数计算

- 基础分：500分
- 时间奖励：剩余时间 × 5分/秒

## 数据持久化

### 保存的数据

- 当前关卡
- 已解锁关卡列表
- 最高分记录
- 总分数
- 金币数量
- 游戏设置

### 存储方式

使用微信小程序本地存储（wx.setStorageSync/wx.getStorageSync）

## 性能优化

1. **对象池**: 预先创建和复用对象
2. **空间分区**: 优化碰撞检测
3. **帧率控制**: 目标60 FPS
4. **懒加载**: 按需加载资源

## 部署说明

### 微信小程序

1. 打开微信开发者工具
2. 导入项目，选择 `game` 目录
3. 填写 AppID
4. 点击"上传"进行发布

### 抖音小游戏

1. 打开抖音开发者工具
2. 导入项目，选择 `game` 目录
3. 填写 AppID
4. 点击"上传"进行发布

## 运行测试

```bash
# 安装依赖
npm install

# 运行测试
npm test

# 生成覆盖率报告
npm test -- --coverage
```

## 项目亮点

1. **完整的游戏引擎**: 包含游戏循环、渲染、物理检测
2. **模块化设计**: 清晰的模块划分，易于维护和扩展
3. **全面的测试**: 96个单元测试，100%通过率
4. **响应式UI**: 适配不同屏幕尺寸
5. **数据持久化**: 保存游戏进度和设置
6. **动画效果**: 浮动、脉冲、弹跳等动画
7. **关卡系统**: 10个精心设计的关卡
8. **星级评定**: 激励玩家挑战更高分数

## 后续扩展建议

1. **更多关卡**: 扩展到50+关卡
2. **成就系统**: 实现成就和奖励
3. **音效和音乐**: 添加背景音乐和音效
4. **排行榜**: 实现好友排行榜
5. **角色皮肤**: 解锁和更换角色皮肤
6. **社交分享**: 分享到朋友圈
7. **特殊道具**: 提示、慢动作、撤销等道具
8. **多章节**: 设计更多章节和主题

## 技术文档

### API文档

所有模块都有详细的注释，包括：
- 方法说明
- 参数说明
- 返回值说明
- 使用示例

### 代码规范

- 遵循ES6+语法规范
- 使用驼峰命名法
- 模块化导出
- 错误处理

## 总结

本项目完整实现了"拯救菜狗"抖音小游戏的所有功能，包括：

✅ 完整的游戏引擎和物理系统
✅ 单位管理和交互系统
✅ 关卡管理和进度系统
✅ 游戏状态管理系统
✅ 四个完整的页面（主页、关卡、游戏、结果）
✅ 数据持久化
✅ 96个单元测试，全部通过
✅ 完整的文档和注释

项目代码质量高，结构清晰，易于维护和扩展。可以直接部署到微信小程序或抖音小游戏平台。
